<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>REPORTE DE ACTIVIDADES ENVIADAS EN EL PERIODO {{period.per_name}}</title>
  <style>
    body {
      font-family: 'Calibri', Arial, sans-serif !important;
      margin: 0; 
      padding: 20px; 
      text-transform: uppercase;
      font-size: 12px;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Calibri', Arial, sans-serif;
      page-break-after: avoid;
      break-after: avoid;
    }
    h1 { 
      text-align: center; 
      font-size: 22px;
      margin-bottom: 10px;
    }
    h2 {
      font-size: 16px;
      margin-top: 5px;
      margin-bottom: 10px;
    }
    table, th, td {
      border: 1px solid #000;
      border-collapse: collapse;
      margin-left: auto;
      margin-right: auto;
      font-size: 10px;
    }
    th, td {
      padding: 2px 4px;
      text-align: center;
    }
    span, strong {
      font-family: 'Calibri', Arial, sans-serif;
      font-size: 8px;
    }
    .subtitle {
      font-family: 'Calibri', Arial, sans-serif;
      page-break-after: avoid;
      break-after: avoid;
      page-break-before: avoid;
      break-before: avoid;
    }
    .table-period { 
      width: 100%; 
      margin-bottom: 10px;
      page-break-inside: avoid;
      break-inside: avoid;
      page-break-after: avoid;
      break-after: avoid;
    }
    .table-career {
      margin-bottom: 10px;
      page-break-inside: avoid;
      break-inside: avoid;
      page-break-after: avoid;
      break-after: avoid;
      font-size: 10px;
    }
    .table-student { 
      margin-right: auto; 
      margin-bottom: 10px;
      page-break-inside: avoid;
      break-inside: avoid;
      page-break-after: avoid;
      break-after: avoid;
    }
    .table-activity { 
      width: 100%; 
      margin-bottom: 10px;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .table-activity th, .table-activity td { 
      text-align: left; 
      padding: 2px 4px;
    }
    .student { 
      margin-bottom: 15px;
      border-bottom: 1px solid #ccc; 
      padding-bottom: 10px;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .student-name { 
      margin-top: 10px;
      margin-bottom: 5px;
      font-size: 12px;
      font-weight: bold; 
      text-align: center;
      page-break-after: avoid;
      break-after: avoid;
      page-break-before: avoid;
      break-before: avoid;
    }
    .student-info { 
      font-size: 12px;
    }
    .activities-title { 
      font-size: 14px;
      font-weight: bold; 
      margin-top: 8px;
      margin-bottom: 5px;
    }
    .activity { 
      margin-bottom: 8px;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .activity-status-approval { 
      color: green; 
      font-size: 8px; 
      font-weight: bold; 
    }
    .activity-status-rejected { 
      color: red; 
      font-size: 8px; 
      font-weight: bold; 
    }
    .evidences {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
      justify-content: center;
    }
    .evidence-img {
      max-width: 48%;
      max-height: 30px;
      height: auto;
      object-fit: contain;
      margin-bottom: 2px;
      margin-top: 2px;
      display: block;
    }
    
    /* Excepción para los correos electrónicos */
    .email {
      text-transform: none;
    }
    .text-center {
      text-align: center;
    }
    .table-activity td[rowspan="3"] {
      vertical-align: top;
      text-align: left;
      padding: 4px;
    }

    /* Contenedor para evitar saltos entre título, tablas y subtítulo */
    .header-section {
      page-break-inside: avoid;
      break-inside: avoid;
      page-break-after: avoid;
      break-after: avoid;
    }
  </style>
</head>
<body>
  <div class="header-section">
    <h1>REPORTE DE ACTIVIDADES ENVIADAS EN EL PERIODO {{period.per_name}}</h1>

    <table class="table-period">
      <tr>
        <th>FECHA DE INICIO</th>
        <th>FECHA DE FIN</th>
        <th>TIPO</th>
        <th>TOTAL DE ESTUDIANTES</th>
      </tr>
      <tr>
        <td>{{formatDate period.per_date_start}}</td>
        <td>{{formatDate period.per_date_end}}</td>
        <td>{{#if period.per_exclusive}}EXCLUSIVO{{else}}REGULAR{{/if}}</td>
        <td>{{students.length}}</td>
      </tr>
    </table>

    <table class="table-career">
      <tr>
        <th>SEDE</th>
        <th>PROGRAMA ACADÉMICO</th>
      </tr>
      <tr>
        <td>{{sede}}</td>
        <td>{{careerFullName}}</td>
      </tr>
    </table>

    <h2 class="subtitle text-center">LISTADO DE ESTUDIANTES</h2>
  </div>

  {{#each students}}
  <div class="student">
    <div class="student-name">{{use_nua}} - {{use_name}} {{use_last_name}} {{use_second_last_name}}</div>

    {{#each activities}}
    <div class="activity">
      <table class="table-activity">
        <tr>
          <td colspan="4">
            <strong>NOMBRE DE LA ACTIVIDAD:</strong>
            <span class="activity-status-{{act_status}}">
              {{#if (eq act_status "approval")}}✓{{else}}✗{{/if}}
            </span>
            <span>{{act_name}}</span>
          </td>
          <td rowspan="3" style="width: 50%;">
            <strong>EVIDENCIAS:</strong>
            <div class="evidences">
              {{#each evidenceBase64}}
                <img src="{{this}}" class="evidence-img" />
              {{/each}}
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="4">
            <strong>INSTITUCIÓN ORGANIZADORA:</strong>
            <span>{{act_institution}}</span>
          </td>
        </tr>
        <tr>
          <td>
            <strong>FECHA DE INICIO:</strong>
            <span>{{formatDate act_date_start}}</span>
          </td>
          <td>
            <strong>FECHA DE FIN:</strong> 
            <span>{{formatDate act_date_end}}</span>
          </td>
          <td>
            <strong>HORAS:</strong>
            <span>{{act_hours}}</span>
          </td>
          <td>
            <strong>AREA:</strong>
            <span>{{act_area}}</span>
          </td>
        </tr>
      </table>
    </div>
    {{/each}}
  </div>
  {{/each}}
</body>
</html>
